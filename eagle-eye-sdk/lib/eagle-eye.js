!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).eagleSDK={})}(this,(function(e){"use strict";var t={canAjax:function(){return window.XMLHttpRequest&&window.JSON},post:function(e,t,n){var o=new XMLHttpRequest;o.open("post",e,!0),o.setRequestHeader("content-type","application/json;charset=utf-8"),o.setRequestHeader("Accept","application/json"),o.timeout=n||3e4,o.sendByEagle=!0,o.onload=function(){(null==o?void 0:o.responseText)&&"string"==typeof(null==o?void 0:o.responseText)&&JSON.parse(o.responseText||"").status},o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){if(!(null==o?void 0:o.responseText)||"string"!=typeof(null==o?void 0:o.responseText))return;(null===JSON||void 0===JSON?void 0:JSON.parse(o.responseText||"")).status}},o.send(window.JSON.stringify(t))}},n=function(){return n=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},o=function(e){var t={data:[],ip:"",_geWrap:function(){var n,o,i={},r=window.navigator;i.uuid=t._getUuid(),i.userAgent=r.userAgent,i.appName=r.appName,i.appVersion=r.appVersion,i.cpuClass=r.cpuClass,i.platform=r.platform,i.language=r.language,i.url=null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.href,i.time=(new Date).getTime(),i.referrer=null===document||void 0===document?void 0:document.referrer;var a=(null===performance||void 0===performance?void 0:performance.timing)||{};return i.time={newPage:(null==a?void 0:a.fetchStart)-(null==a?void 0:a.navigationStart)||0,redirect:(null==a?void 0:a.redirectEnd)-(null==a?void 0:a.redirectStart)||0,appcache:(null==a?void 0:a.domainLookupStart)-(null==a?void 0:a.fetchStart)||0,unload:(null==a?void 0:a.unloadEventEnd)-(null==a?void 0:a.unloadEventStart)||0,dnsLooking:(null==a?void 0:a.domainLookupEnd)-(null==a?void 0:a.domainLookupStart)||0,tcpConnect:(null==a?void 0:a.connectEnd)-(null==a?void 0:a.connectStart)||0,request:(null==a?void 0:a.responseEnd)-(null==a?void 0:a.requestStart)||0,whiteScreen:(null==a?void 0:a.responseStart)-(null==a?void 0:a.navigationStart)||0,domParse:(null==a?void 0:a.domComplete)-(null==a?void 0:a.domInteractive)||0},i.resourceLoading=[],e.sendResource&&(null===(o=null===performance||void 0===performance?void 0:performance.getEntriesByType("resource"))||void 0===o||o.forEach((function(t,n){var o,r,a,d,u,l,c,s,v,p;if(!(-1!==e.resourceUrl.indexOf(t.name)&&"xmlhttprequest"!==t.initiatorType||n<=e.resourceIndex)){e.resourceUrl.push(t.name),e.resourceIndex=n;var f={name:t.name,entryType:t.entryType,initiatorType:t.initiatorType,nextHopProtocol:t.nextHopProtocol,transferSize:t.transferSize};if("xmlhttprequest"!==t.initiatorType&&"fetch"!==t.initiatorType){if((null===(o=t.responseEnd)||void 0===o?void 0:o.toFixed(0))-(null===(r=t.responseStart)||void 0===r?void 0:r.toFixed(0))<500)return;f.loading=(null===(a=t.responseEnd)||void 0===a?void 0:a.toFixed(0))-(null===(d=t.responseStart)||void 0===d?void 0:d.toFixed(0))||void 0,f.prepareLoading=(null===(u=t.responseStart)||void 0===u?void 0:u.toFixed(0))-(null===(l=t.startTime)||void 0===l?void 0:l.toFixed(0))||void 0,i.resourceLoading.push(f)}else{if((null===(c=t.responseEnd)||void 0===c?void 0:c.toFixed(0))-(null===(s=t.fetchStart)||void 0===s?void 0:s.toFixed(0))<500)return;f.loading=(null===(v=t.responseEnd)||void 0===v?void 0:v.toFixed(0))-(null===(p=t.fetchStart)||void 0===p?void 0:p.toFixed(0))||void 0,f.prepareLoading=0,i.resourceLoading.push(f)}}}))),i},_getIP:function(e){var t=new((null===window||void 0===window?void 0:window.RTCPeerConnection)||(null===window||void 0===window?void 0:window.mozRTCPeerConnection)||(null===window||void 0===window?void 0:window.webkitRTCPeerConnection))({iceServers:[{urls:"stun:stun01.sipphone.com"},{urls:"stun:stun.ekiga.net"},{urls:"stun:stun.fwdnet.net"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.l.google.com:19302"}]}),n=function(){},o={},i=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;function r(t){o[t]||e(t),o[t]=!0}t.createDataChannel(""),t.createOffer().then((function(e){e.sdp.split("\n").forEach((function(e){e.indexOf("candidate")<0||e.match(i).forEach(r)})),t.setLocalDescription(e,n,n)})).catch((function(e){})),t.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(i)&&e.candidate.candidate.match(i).forEach(r)}},_getUuid:function(){var e,t=localStorage.getItem("eagle-uuid")||(e=(new Date).getTime(),window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})));return t&&localStorage.setItem("eagle-uuid",t),t},_getErrorMessage:function(e,t){var o=this._geWrap();return this._getIP((function(e){o.ip=e})),o.detail={},o.detail=n({},e.detail),o.event_type=e.type,"error"===e.type&&(o.detail.message=e.message,o.detail.line=e.lineno,o.detail.filename=e.filename,o.event_type="error"),t&&(o.detail.src=e.target.src||e.target.href,o.event_type="resource",o.event_type="resource"),o},_getEventMessage:function(e,t){var o=this,i=this._geWrap();return this.ip||this._getIP((function(e){o.ip=e,i.ip=e})),i.detail=n({},t),i.event_type=e,i}};return t},i=function(e,t,n){var i=o(t)._getErrorMessage(e,n);return i.record=[],i.app_key=t.app_key,i},r=function(e,n){var o=i(e,n);t.post(n.protocol+n.url,o)},a=function(e,n){var o=i(e,n);t.post(n.protocol+n.url,o)};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var d=function(){return{data:[],record:[],_get:function(){return this.data},_getRecord:function(){return this.record},_set:function(e){this.data.push(e)},_setRecord:function(e){this.record.push(e)},_clearRecord:function(){this.record.splice(0,self.record.length)}}},u=function(e,n,i){var r=function(e,t,n){var i=o(n)._getEventMessage(e,t);return i.app_key=n.app_key,i.firstScreenTime=n.firstScreenTime||0,i}(e,n,i);t.post(i.protocol+i.url,r,(function(){i._clearEvent()}))},l=function(e,t){var n=function(e){var t={https:!0,url:"/monitor",record:!1,app_key:"",resourceUrl:[],resourceIndex:-1,startTime:(new Date).getTime()||0,globalClick:!0,sendResource:!0,disableHook:!1,disableFetch:!1,autoSendPv:!0,enableSPA:!0,openHeartbeat:!1,sample:1,beginTiming:0,costTime:0,_extend:function(e,t){return Object.keys(t).map((function(n){e[n]=t[n]})),e}};return t._extend(t,e)}(e);return n.event=t,n.eventCenter=d(),n.protocol=window.location.protocol+"//",n.https&&(n.protocol="https://"),c(n),n.enableSPA&&f(n),s(n),n.disableHook||v(n),n.disableFetch||p(n),n.globalClick&&g(n),n.openHeartbeat&&m(n),n},c=function(e){if(window.MutationObserver){var t="pending",n=[],o=0,i=function(e,n){c&&(n||s(e)?(c.disconnect(),c=null,d(),t="finished"):setTimeout((function(){i(e)}),500))},r=function(){"pending"===t&&i(0,!0),window.ActiveXObject||"ActiveXObject"in window||window.removeEventListener("beforeunload",r)};window.addEventListener("beforeunload",r);var a=function(e){for(var t=1;t<e.length;t++)if(e[t].score<e[t-1].score)return e.splice(t,1),a(e);return e},d=function(){var t,i,r,d;n=a(n);for(var l=1;l<n.length;l++)if(n[l].time>=n[l-1].time){var c=n[l].score-n[l-1].score;(!d||d.rate<=c)&&(d={time:n[l].time,rate:c})}o=(null==d?void 0:d.time)||0,e.firstScreenTime=o,e.autoSendPv&&u("uv",{domready:!1,url:(null===(i=null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href)||void 0===i?void 0:i.split("?")[0])||"",type:1===(null===(r=null===performance||void 0===performance?void 0:performance.navigation)||void 0===r?void 0:r.type)?"reload":"normal"},e)},l=function(e,t,n){var o=window.innerHeight||0,i=0,r=e.tagName;if("SCRIPT"!==r&&"STYLE"!==r&&"META"!==r&&"HEAD"!==r){var a=e.children?e.children.length:0;if(a>0)for(var d=e.children,u=a-1;u>=0;u--)i+=l(d[u],t+1,i>0);if(i<=0&&!n&&e.getBoundingClientRect&&e.getBoundingClientRect().top>=o)return 0;i+=1+.5*t}return i},c=new window.MutationObserver((function(){var t=(new Date).getTime()-e.startTime,o=document.querySelector("body"),i=0;o?(i=l(o,1,!1),n.push({score:i,time:t})):n.push({score:0,time:t})}));c.observe(document,{childList:!0,subtree:!0}),c=c,e.observerData=n;var s=function(t){var o=Date.now()-e.startTime,i=n&&n.length&&n[n.length-1].time||0;return o>t||o-i>1e3};"complete"===document.readyState?i(1e4):window.addEventListener("load",(function(){i(1e4)}),!1)}},s=function(e){var n=function(t){console.log(t),a(t,e)},o=function(n){if(n.cancelable){if(n.filename.indexOf("eagle-eye")>-1)return;a(n,e)}else!function(e,n){var o=i(e,n,!0);t.post(n.protocol+n.url,o)}(n,e)};window.addEventListener("unhandledrejection",n),window.addEventListener("error",o,!0),e.eventCenter._set({type:"unhandledrejection",func:n}),e.eventCenter._set({type:"error",func:o})},v=function(e){if(window.XMLHttpRequest&&window.XMLHttpRequest.prototype){var t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,n){try{this.eagleTemp={method:e,url:n,startTime:(new Date).getTime()}}catch(e){}t&&t.apply(this,arguments)};var n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(t){try{var o=this,i=o.onloadend;o.onloadend=function(t){try{if(this.sendByEagle)return;var n=(new Date).getTime()-o.eagleTemp.startTime,i=o.eagleTemp.method,a=t.target,d=a.responseURL||o.eagleTemp.url,u=a.status,l=a.statusText,c=a.response;200!==u&&r({type:"ajaxLoad",detail:{apiCost:n,method:i,responseURL:d,status:u,statusText:l,response:c}},e),n>=400&&r({type:"ajaxSlow",detail:{apiCost:n,method:i,responseURL:d,status:u,statusText:l,response:c}},e)}catch(e){}},i&&i.apply(this,arguments)}catch(e){}n&&n.apply(this,arguments)}}},p=function(e){if(window.fetch){var t=fetch;window.fetch=function(n,o){return t.apply(this,arguments).catch((function(t){try{r({type:"fetchError",detail:{method:"fetch",responseURL:n,response:JSON.stringify(t)}},e)}catch(t){}return t}))}}},f=function(e){var t=function(){var t,n;u("pv",{url:(null===(n=null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href)||void 0===n?void 0:n.split("?")[0])||""},e)};window.addEventListener("hashchange",t),e.eventCenter._set({type:"hashchange",func:t});var n=function(e){var t=null===history||void 0===history?void 0:history[e],n=new Event(e);return function(){var e=t.apply(this,arguments);return n.arguments=arguments,window.dispatchEvent(n),e}};history.pushState=n("pushState"),history.replaceState=n("replaceState"),window.addEventListener("pushState",t),e.eventCenter._set({type:"pushState",func:t}),window.addEventListener("replaceState",t),e.eventCenter._set({type:"replaceState",func:t})},g=function(e){var t,n=function(t){var n,o,i=function(e){var t;if(!e)return{};var n={id:"",type:""},o="",i={id:e.id,name:e.name,className:"",tag:e.tagName.toLowerCase(),type:e.type?e.type.toLowerCase():"",classList:e.classList||[]};if(e.classList.forEach((function(e){/^[a-zA-Z]/.test(e)&&(o+="."+e)})),i.className=o,"body"!==i.tag&&"html"!==i.tag||(n.id=i.tag,n.type=i.tag),i.id&&document.getElementById(i.id)===e){var r=i.tag+"#"+i.id;try{document.querySelector(r)===e&&(n.id=r)}catch(e){console.log("id 不合法")}n.type="getElementById"}if(!n.id&&i.name&&document.getElementsByName(i.name)[0]===e&&(n.id=i.name,n.type="getElementsByName"),!n.id&&o&&document.querySelector(i.tag+o)===e&&(n.id=i.tag+o,n.type="querySelector"),!n.id&&"radio"===i.type){var a=e.value,d=i.tag+"[value='"+a+"']";i.name&&(d+="[name='"+i.name+"']"),document.querySelector(d)===e&&(n.id=d,n.type="querySelector")}if(!n.id&&"a"===i.tag){var u=null===(t=e.attributes.href)||void 0===t?void 0:t.value;u&&(d="a[href='"+u+"']",document.querySelector(d)===e&&(n.id=d,n.type="querySelector"))}n.id||(d=i.tag,d=o?d+o:d,d=i.name?d+"[name='"+i.name+"']":d,document.querySelector(d)===e&&(n.id=d,n.type="querySelector"));if(!n.id){d=i.tag,d=o?d+o:d;var l=document.querySelectorAll(d);if(l&&l.length>0){for(var c=null,s=0;s<l.length;s++)if(e===l[s]){c=s+1;break}c&&(d=d+":nth-child("+c+")",document.querySelector(d)===e&&(n.id=d,n.type="querySelector"))}}return n}(null==t?void 0:t.target);i.id&&i.type&&u("click",{url:(null===(o=null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.href)||void 0===o?void 0:o.split("?")[0])||"",dom:i},e)};null===(t=null===document||void 0===document?void 0:document.body)||void 0===t||t.addEventListener("click",n),e.eventCenter._set({type:"clickEvent",func:n})},m=function(e){"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js",{scope:"./"}).then((function(t){var n;if(null!==(null===(n=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===n?void 0:n.controller)){var o=function(){var t,n;null===(n=null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:"running",id:"",data:e})};window.addEventListener("beforeunload",(function(){var e,t;null===(t=null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||void 0===t||t.postMessage({type:"clear",id:""})})),setInterval(o,5e3),o()}}))};e.initMonitor=function(e){var t=d(),n=function(e){return{config:e,destory:function(){for(var e,t,n=null===(t=null===(e=this.config)||void 0===e?void 0:e.eventCenter)||void 0===t?void 0:t._get(),o=0;o<n.length;o++)"error"===n[o].type?window.removeEventListener(n[o].type,n[o].func,!0):window.removeEventListener(n[o].type,n[o].func)},getRecord:function(){return this.config._getRrwebEvent()},report:function(e,t){return void 0===t&&(t={}),u(e,t,this.config)},start:function(){this.config.beginTiming=(new Date).getTime()},stop:function(){this.config.beginTiming>0?(this.config.costTime=(new Date).getTime()-this.config.beginTiming,this.config.beginTiming=0):this.config.costTime=(new Date).getTime()-this.config.startTime}}}(l(e,t));return n},Object.defineProperty(e,"__esModule",{value:!0})}));
